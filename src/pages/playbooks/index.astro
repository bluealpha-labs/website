---
import Layout from '#layouts/layout.astro'
import { getCollection } from 'astro:content'
import { ContentHeader01 } from '#components/content/content-header/content-header-01.tsx'
import { authorNames } from '#constants/author.ts'
import { RemainingContent01 } from '#components/content/remaining-content/remaining-content-01.tsx'
import { tagColors, tagNames } from '#constants/playbook.ts'
import { formatDate } from '#utils/format.ts'
import { pageTitle } from '#utils/seo.ts'

const collection = await getCollection('playbooks')
const published = collection.filter((entry) => entry.data.status === 'published')
const sorted = published.slice().sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
---

<Layout className='py-20' title={pageTitle('Playbooks')}>
  <ContentHeader01
    label='Playbooks'
    title='Operate Like a Growth Scientist'
    titleAs='h1'
    description='Fast-track marketing ROI for growth leaders. Tactical guides, frameworks, and decision workflows for turning noisy data into confident decisions.'
    descriptionAs='h2'
  />
  <RemainingContent01
    title='All playbooks'
    items={sorted.map(({ data, slug }) => {
      const authorName = authorNames[data.author]
      const formattedDate = formatDate(data.date)

      return {
        id: slug,
        title: data.title,
        description: data.description,
        image: data.image.src,
        author: authorName,
        date: formattedDate,
        tags: data.tags.map((tag) => ({
          name: tagNames[tag],
          color: tagColors[tag]
        })),
        href: `/playbooks/${slug}`
      }
    })}
  />
</Layout>
