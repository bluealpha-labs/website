---
import Layout from '#layouts/layout.astro'
import { getCollection } from 'astro:content'
import { ContentHeader01 } from '#components/content/content-header/content-header-01.tsx'
import { RecentContent01 } from '#components/content/recent-content/recent-content-01.tsx'
import { authorNames } from '#constants/author.ts'
import { RemainingContent01 } from '#components/content/remaining-content/remaining-content-01.tsx'
import { tagColors, tagNames } from '#constants/article.ts'
import { formatDate } from '#utils/format.ts'

const collection = await getCollection('articles')
const published = collection.filter((entry) => entry.data.status === 'published')
const sorted = published.toSorted((a, b) => b.data.date.getTime() - a.data.date.getTime())
const recent = sorted.slice(0, 3)
const remaining = sorted.slice(3)
---

<Layout className='py-20'>
  <ContentHeader01
    label='Articles'
    title='Reads the latest from BlueAlpha'
    description='Thoughts on MMM, incrementality, and growth operations from our team.'
  />
  <RecentContent01
    title='Recent articles'
    items={recent.map(({ data, slug }) => {
      const authorName = authorNames[data.author]
      const formattedDate = formatDate(data.date)

      return {
        title: data.title,
        description: data.description,
        image: data.image.src,
        author: authorName,
        date: formattedDate,
        tags: data.tags.map((tag) => ({
          name: tagNames[tag],
          color: tagColors[tag]
        })),
        href: `/articles/${slug}`
      }
    })}
  />
  <RemainingContent01
    title='All articles'
    items={remaining.map(({ data, slug }) => {
      const authorName = authorNames[data.author]
      const formattedDate = formatDate(data.date)

      return {
        title: data.title,
        description: data.description,
        image: data.image.src,
        author: authorName,
        date: formattedDate,
        tags: data.tags.map((tag) => ({
          name: tagNames[tag],
          color: tagColors[tag]
        })),
        href: `/articles/${slug}`
      }
    })}
  />
</Layout>
